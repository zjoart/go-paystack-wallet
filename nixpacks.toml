[phases.setup]
nixPkgs = ["go", "gnumake"]

[phases.build]
cmds = [
    "go install -tags 'postgres' github.com/golang-migrate/migrate/v4/cmd/migrate@latest",
    "go build -o main ./cmd/server/main.go"
]

[start]
cmd = "make migrate-retry && ./main"
